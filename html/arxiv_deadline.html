<!DOCTYPE html>
<!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã«ã™ã‚‹ -->
<html lang="ja" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>arXiv ç· åˆ‡ãƒã‚§ãƒƒã‚«ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€ï¼ˆTailwindã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã¨æ–‡å­—è‰² -->
<body class="bg-gray-900 text-gray-200">

    <div class="grid place-items-center min-h-screen p-4">
        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒ†ãƒŠè‰² -->
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-sm p-6 sm:p-8 w-full max-w-2xl">
            
            <h1 class="text-2xl font-bold text-red-500 mb-4 pb-2 border-b border-gray-700">
                arXiv ç· åˆ‡ãƒã‚§ãƒƒã‚«ãƒ¼
            </h1>

            <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
            <div id="error-display" class="hidden bg-red-900 border border-red-700 text-red-200 rounded-md p-3 text-sm mb-4">
                ã‚¨ãƒ©ãƒ¼: å†…éƒ¨æ™‚åˆ»ã®è¨ˆç®—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
            </div>

            <div class="grid sm:grid-cols-2 gap-4 mb-4">
                <!-- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³é¸æŠ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
                <div>
                    <label for="timezone-select" class="block text-sm font-medium text-gray-400 mb-1">ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³</label>
                    <select id="timezone-select" class="w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-base bg-gray-700 text-gray-100">
                        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                    </select>
                </div>
                <!-- ç· åˆ‡é¸æŠ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
                <div>
                    <label for="deadline-selector" class="block text-sm font-medium text-gray-400 mb-1">è¡¨ç¤ºã™ã‚‹ç· åˆ‡</label>
                    <select id="deadline-selector" class="w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-base bg-gray-700 text-gray-100">
                        <option value="next" selected>æ¬¡ã®æŠ•ç¨¿ç· åˆ‡</option>
                        <option value="previous">å‰å›ã®æŠ•ç¨¿ç· åˆ‡</option>
                    </select>
                </div>
            </div>

            <!-- ç· åˆ‡ãƒ»å…¬é–‹ã‚«ãƒ¼ãƒ‰ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
            <div class="grid sm:grid-cols-2 gap-4">
                <div class="bg-gray-850 border border-gray-700 rounded-lg p-4" style="background-color: #1f2937;"> <!-- 'bg-gray-850' (ã‚«ã‚¹ã‚¿ãƒ ) -->
                    <h2 class="text-sm font-medium text-gray-400 mb-1">
                        <span id="deadline-label-prefix">ğŸ“œ æ¬¡ã®</span>æŠ•ç¨¿ç· åˆ‡
                    </h2>
                    <p id="deadline" class="text-lg font-semibold text-gray-100">è¨ˆç®—ä¸­...</p>
                </div>
                <div class="bg-gray-850 border border-gray-700 rounded-lg p-4" style="background-color: #1f2937;">
                    <h2 class="text-sm font-medium text-gray-400 mb-1">ğŸ“¢ å¯¾å¿œã™ã‚‹å…¬é–‹æ—¥æ™‚</h2>
                    <p id="announce" class="text-lg font-semibold text-gray-100">è¨ˆç®—ä¸­...</p>
                </div>
            </div>

            <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
            <div id="countdown-wrapper" class="mt-5 text-center">
                <h2 class="text-sm font-medium text-gray-400">ç· åˆ‡ã¾ã§ã®æ®‹ã‚Šæ™‚é–“</h2>
                <div id="countdown" class="text-2xl font-bold text-gray-100 mt-1">...</div>
            </div>
            
            <!-- éå»ã®ç· åˆ‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
            <div id="previous-info" class="hidden mt-5 text-center text-sm text-gray-500">
                éå»ã®ç· åˆ‡ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
            </div>

            <!-- ãƒ•ãƒƒã‚¿ãƒ¼ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰) -->
            <footer class="mt-6 pt-4 border-t border-gray-700 text-sm text-gray-500 text-center">
                <p class="font-medium text-gray-400 mb-2">å…¬å¼æƒ…å ± (arXiv.org)</p>
                <div class="flex justify-center gap-4">
                    <a href="https://arxiv.org/localtime" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">
                        arXiv Local Time
                    </a>
                    <a href="https://info.arxiv.org/help/availability.html" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">
                        Submission Schedule
                    </a>
                </div>
                <p class="mt-3 text-xs">
                    â€» ç¥æ—¥ (Holiday) ã«ã‚ˆã‚Šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå¤‰æ›´ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
                </p>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            populateTimezoneSelector();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.getElementById('timezone-select').addEventListener('change', updateTimes);
            document.getElementById('deadline-selector').addEventListener('change', updateTimes);

            // åˆå›å®Ÿè¡Œ
            updateTimes();
            
            // 1åˆ†ã”ã¨ã«æ›´æ–°ï¼ˆãŸã ã—ã€Œæ¬¡å›ã€ã®æ™‚ã®ã¿ï¼‰
            setInterval(() => {
                const mode = document.getElementById('deadline-selector').value;
                if (mode === 'next') {
                    updateTimes();
                }
            }, 60000); 
        });

        /**
         * ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã«å¿…è¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‹•çš„ã«è¿½åŠ ã—ã¾ã™ã€‚
         */
        function populateTimezoneSelector() {
            const select = document.getElementById('timezone-select');
            let userTz;
            try {
                userTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            } catch (e) {
                userTz = 'UTC'; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            }

            // è¡¨ç¤ºã™ã‚‹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®ãƒªã‚¹ãƒˆã¨ãƒãƒƒãƒ”ãƒ³ã‚°
            const tzMap = {
                [userTz]: { name: `ã‚ãªãŸã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ (${getTzAbbreviation(userTz)})`, order: 1 },
                'Asia/Tokyo': { name: 'æ—¥æœ¬ (JST)', order: 2 },
                'America/New_York': { name: 'ç±³å›½æ±éƒ¨ (ET)', order: 3 },
                'America/Los_Angeles': { name: 'ç±³å›½å¤ªå¹³æ´‹ (PT)', order: 4 },
                'Europe/London': { name: 'ã‚¤ã‚®ãƒªã‚¹ (GMT/BST)', order: 5 },
                'Europe/Berlin': { name: 'ä¸­å¤®ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ (CET/CEST)', order: 6 },
                'Europe/Paris': { name: 'ä¸­å¤®ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ (CET/CEST)', order: 6 },
                'UTC': { name: 'å”å®šä¸–ç•Œæ™‚ (UTC)', order: 7 },
                'Asia/Shanghai': { name: 'ä¸­å›½ (CST)', order: 8 },
                'Australia/Sydney': { name: 'ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢æ±éƒ¨ (AEST/AEDT)', order: 9 }
            };

            // é‡è¤‡ã‚’å‰Šé™¤ã—ã€orderã§ã‚½ãƒ¼ãƒˆ
            const sortedTz = Object.keys(tzMap)
                .map(key => ({ id: key, ...tzMap[key] }))
                .sort((a, b) => a.order - b.order);

            // é‡è¤‡ã™ã‚‹åå‰ã‚’å‰Šé™¤ï¼ˆä¾‹ï¼šBerlinã¨Parisï¼‰
            const uniqueTz = [];
            const namesSeen = new Set();
            for (const tz of sortedTz) {
                if (!namesSeen.has(tz.name)) {
                    uniqueTz.push(tz);
                    namesSeen.add(tz.name);
                }
            }

            // <option> ã‚’è¿½åŠ 
            uniqueTz.forEach(tz => {
                const option = document.createElement('option');
                option.value = tz.id;
                option.textContent = tz.name;
                // 'ã‚ãªãŸã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³' ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é¸æŠ
                if (tz.id === userTz) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        /**
         * ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³IDã‹ã‚‰ç¾åœ¨ã®ç•¥ç§°ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
         */
        function getTzAbbreviation(timeZone) {
            try {
                const options = { timeZone, timeZoneName: 'short' };
                const str = new Intl.DateTimeFormat('en-US', options).format(new Date());
                // "11/4/2025, JST" ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã‹ã‚‰ "JST" ã‚’æŠ½å‡º
                const parts = str.split(', ');
                if (parts.length > 1) {
                    // "JST" ã‚„ "GMT+9" ãªã©ã‚’è¿”ã™
                    const tzName = parts[parts.length - 1];
                    // "GMT+9" ã®ã‚ˆã†ãªå½¢å¼ã‚’ "+9" ã«
                    if (tzName.startsWith('GMT')) {
                        return tzName.substring(3);
                    }
                    return tzName;
                }
                // "GMT-4" ã®ã‚ˆã†ãª shortOffset ã®å ´åˆ
                const offsetStr = new Intl.DateTimeFormat('en-US', { timeZone, timeZoneName: 'shortOffset' }).format(new Date());
                return offsetStr.replace('GMT', ''); // "GMT-4" -> "-4"
            } catch (e) {
                return timeZone; // ã‚¨ãƒ©ãƒ¼æ™‚ã¯IDã‚’ãã®ã¾ã¾è¿”ã™
            }
        }


        /**
         * ãƒ¡ã‚¤ãƒ³ã®æ›´æ–°é–¢æ•°
         */
        function updateTimes() {
            const outputDeadline = document.getElementById('deadline');
            const outputAnnounce = document.getElementById('announce');
            const countdownEl = document.getElementById('countdown');
            const countdownWrapper = document.getElementById('countdown-wrapper');
            const previousInfo = document.getElementById('previous-info');
            const errorEl = document.getElementById('error-display');
            const deadlineLabelPrefix = document.getElementById('deadline-label-prefix');

            const deadlineSelect = document.getElementById('deadline-selector');
            const timezoneSelect = document.getElementById('timezone-select');

            let etOffsetHours = NaN; // ETã®UTCã‚ªãƒ•ã‚»ãƒƒãƒˆ (-4 ã¾ãŸã¯ -5)
            const ET_TIMEZONE = 'America/New_York';

            // --- 1. PCã®æ™‚è¨ˆã‚’ãƒã‚§ãƒƒã‚¯ ---
            const now = new Date();
            if (isNaN(now.getTime())) {
                console.error('CRITICAL: System clock is invalid (new Date() is NaN).');
                errorEl.textContent = 'ã‚¨ãƒ©ãƒ¼: ãŠä½¿ã„ã®PCã®æ™‚è¨ˆãŒä¸æ­£ã§ã™ã€‚';
                errorEl.classList.remove('hidden');
                outputDeadline.textContent = 'ã‚¨ãƒ©ãƒ¼';
                outputAnnounce.textContent = 'ã‚¨ãƒ©ãƒ¼';
                return;
            }

            // --- 2. ETã®æ™‚å·®ã‚’å®‰å…¨ã«è¨ˆç®— (Plan A, B, C) ---
            try {
                // Plan A: shortOffset (ä¾‹: "GMT-4")
                let offsetStr = new Intl.DateTimeFormat('en-US', {
                    timeZone: ET_TIMEZONE,
                    timeZoneName: 'shortOffset'
                }).format(now); 

                if (offsetStr.startsWith('GMT')) {
                    const offset = parseInt(offsetStr.replace('GMT', ''), 10);
                    if (!isNaN(offset)) {
                        etOffsetHours = offset;
                    }
                }
                
                // Plan B: longOffset (ä¾‹: "GMT-04:00")
                if (isNaN(etOffsetHours)) {
                    offsetStr = new Intl.DateTimeFormat('en-US', {
                        timeZone: ET_TIMEZONE,
                        timeZoneName: 'longOffset'
                    }).format(now);
                    
                    if (offsetStr.startsWith('GMT')) {
                        const parts = offsetStr.replace('GMT', '').split(':');
                        const offset = parseInt(parts[0], 10);
                         if (!isNaN(offset)) {
                            etOffsetHours = offset;
                        }
                    }
                }

                // Plan C: æ‰‹å‹•è¨ˆç®— (formatToParts)
                if (isNaN(etOffsetHours)) {
                    const utcFormatter = new Intl.DateTimeFormat('en-US', { timeZone: 'UTC', hour12: false, year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric' });
                    const etFormatter = new Intl.DateTimeFormat('en-US', { timeZone: ET_TIMEZONE, hour12: false, year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric' });
                    
                    const utcParts = utcFormatter.formatToParts(now).reduce((acc, part) => { acc[part.type] = part.value; return acc; }, {});
                    const etParts = etFormatter.formatToParts(now).reduce((acc, part) => { acc[part.type] = part.value; return acc; }, {});

                    const utcDate = Date.UTC(
                        parseInt(utcParts.year, 10),
                        parseInt(utcParts.month, 10) - 1,
                        parseInt(utcParts.day, 10),
                        (parseInt(utcParts.hour, 10) || 0) % 24, // 24æ™‚ã‚’0æ™‚ã«
                        (parseInt(utcParts.minute, 10) || 0)
                    );
                    
                    const etDate = Date.UTC(
                        parseInt(etParts.year, 10),
                        parseInt(etParts.month, 10) - 1,
                        parseInt(etParts.day, 10),
                        (parseInt(etParts.hour, 10) || 0) % 24, // 24æ™‚ã‚’0æ™‚ã«
                        (parseInt(etParts.minute, 10) || 0)
                    );

                    if (!isNaN(utcDate) && !isNaN(etDate)) {
                        etOffsetHours = (etDate - utcDate) / (1000 * 60 * 60);
                    }
                }

            } catch (e) {
                console.error('ET Offset calculation failed:', e);
                // ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¯ try/catch ã®å¤–ã§è¡Œã†
            }

            // --- 3. æ™‚å·®è¨ˆç®—ãŒå¤±æ•—ã—ãŸã‚‰å‡¦ç†ã‚’åœæ­¢ ---
            if (isNaN(etOffsetHours)) {
                console.error('CRITICAL: Could not determine ET offset (etOffsetHours is NaN).');
                errorEl.textContent = 'ã‚¨ãƒ©ãƒ¼: ETï¼ˆç±³å›½æ±éƒ¨ï¼‰ã®æ™‚å·®ã‚’è¨ˆç®—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚';
                errorEl.classList.remove('hidden');
                outputDeadline.textContent = 'ã‚¨ãƒ©ãƒ¼';
                outputAnnounce.textContent = 'ã‚¨ãƒ©ãƒ¼';
                countdownWrapper.classList.add('hidden');
                return;
            }

            // --- 4. ç· åˆ‡è¨ˆç®— ---
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
            errorEl.classList.add('hidden');

            const nowInET = new Date(now.getTime() + (etOffsetHours * 3600 * 1000));
            
            const deadlineETHour = 14; // 14:00 ET
            const announceETHour = 20; // 20:00 ET

            const deadlineUTCHour = deadlineETHour - etOffsetHours;
            const announceUTCHour = announceETHour - etOffsetHours;

            const mode = deadlineSelect.value; // "next" ã¾ãŸã¯ "previous"
            let deadlineDate, announceDate;

            // nowInET ãŒæœ‰åŠ¹ãª Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹å ´åˆã®ã¿è¨ˆç®—ã«é€²ã‚€
            if (nowInET instanceof Date && !isNaN(nowInET.getTime())) {
                
                if (mode === 'next') {
                    const dates = getNextDeadlineET(nowInET, deadlineUTCHour, announceUTCHour);
                    deadlineDate = dates.deadline;
                    announceDate = dates.announce;
                    
                    // UIæ›´æ–°
                    countdownWrapper.classList.remove('hidden');
                    previousInfo.classList.add('hidden');
                    deadlineLabelPrefix.textContent = 'ğŸ“œ æ¬¡ã®';

                    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
                    const diffMs = deadlineDate.getTime() - now.getTime();
                    if (diffMs < 0) {
                        countdownEl.textContent = "ç· åˆ‡å‡¦ç†ä¸­ã§ã™...";
                        countdownEl.classList.remove('text-red-500'); // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã«ä¿®æ­£
                    } else {
                        const totalMinutes = Math.floor(diffMs / (1000 * 60));
                        const days = Math.floor(totalMinutes / (60 * 24));
                        const hours = Math.floor((totalMinutes % (60 * 24)) / 60);
                        const minutes = totalMinutes % 60;
                        
                        let countdownStr = "";
                        if (days > 0) countdownStr += `${days}æ—¥ `;
                        if (hours > 0 || days > 0) countdownStr += `${hours}æ™‚é–“ `;
                        countdownStr += `${minutes}åˆ†`;
                        countdownEl.textContent = countdownStr;

                        // 10åˆ†å‰ã«ãªã£ãŸã‚‰èµ¤ãã™ã‚‹
                        if (totalMinutes < 10) {
                            countdownEl.classList.add('text-red-500');
                        } else {
                            countdownEl.classList.remove('text-red-500');
                        }
                    }

                } else { // mode === 'previous'
                    const dates = getPreviousDeadlineET(nowInET, deadlineUTCHour, announceUTCHour);
                    deadlineDate = dates.deadline;
                    announceDate = dates.announce;

                    // UIæ›´æ–°
                    countdownWrapper.classList.add('hidden');
                    previousInfo.classList.remove('hidden');
                    deadlineLabelPrefix.textContent = 'ğŸ“œ å‰å›ã®';
                    countdownEl.classList.remove('text-red-500');
                }
            
            } else {
                // nowInET ãŒ Invalid Date ã ã£ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (TypeError å¯¾ç­–)
                console.error('CRITICAL: nowInET is an invalid Date before calling deadline function. Aborting.');
                errorEl.textContent = 'ã‚¨ãƒ©ãƒ¼: å†…éƒ¨æ™‚åˆ»ã®è¨ˆç®—ã«å¤±æ•—ã—ã¾ã—ãŸ (Invalid Date)ã€‚';
                errorEl.classList.remove('hidden');
                outputDeadline.textContent = 'ã‚¨ãƒ©ãƒ¼';
                outputAnnounce.textContent = 'ã‚¨ãƒ©ãƒ¼';
                countdownWrapper.classList.add('hidden');
                return; // å‡¦ç†ã‚’åœæ­¢
            }


            // --- 5. è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ±ºå®š ---
            const selectedTzValue = timezoneSelect.value;
            const userTzId = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            let locale = 'en-US'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯è‹±èª
            
            // æ—¥æœ¬èªã§è¡¨ç¤ºã™ã‚‹æ¡ä»¶:
            // 1. ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ "Asia/Tokyo" ãŒé¸æŠã•ã‚ŒãŸ
            // 2. ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ "ã‚ãªãŸã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³" ãŒé¸æŠã•ã‚Œã€ã‹ã¤ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒ "Asia/Tokyo"
            if (selectedTzValue === 'Asia/Tokyo' || (selectedTzValue === userTzId && userTzId === 'Asia/Tokyo')) {
                locale = 'ja-JP';
            }

            const formatter = new Intl.DateTimeFormat(locale, {
                timeZone: selectedTzValue,
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short',
            });

            outputDeadline.textContent = formatter.format(deadlineDate);
            outputAnnounce.textContent = formatter.format(announceDate);
        }

        /**
         * æ¬¡ã®ç· åˆ‡ (æœªæ¥) ã‚’è¨ˆç®—ã—ã¾ã™
         */
        function getNextDeadlineET(nowInET_Date, deadlineUTCHour, announceUTCHour) {
            // nowInET_Date ã¯ Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (UTCæ™‚åˆ»åŸºæº–)
            const etDay = nowInET_Date.getUTCDay();   // 0=Sun, 1=Mon, ..., 6=Sat
            const etHour = nowInET_Date.getUTCHours(); // 0-23

            let deadlineDate = new Date(nowInET_Date.getTime());
            deadlineDate.setUTCHours(deadlineUTCHour, 0, 0, 0);

            let announceDate = new Date(nowInET_Date.getTime());
            announceDate.setUTCHours(announceUTCHour, 0, 0, 0);

            // arXivã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ã‚¸ãƒƒã‚¯
            if (etDay === 0) { // Sunday
                if (etHour >= 14) {
                    addDaysUTC(deadlineDate, 1); // Mon
                    addDaysUTC(announceDate, 1);
                }
            } else if (etDay >= 1 && etDay <= 3) { // Mon, Tue, Wed
                if (etHour >= 14) {
                    addDaysUTC(deadlineDate, 1); // Next day
                    addDaysUTC(announceDate, 1);
                }
            } else if (etDay === 4) { // Thursday
                if (etHour >= 14) {
                    addDaysUTC(deadlineDate, 3); // Sun
                    addDaysUTC(announceDate, 3);
                }
            } else if (etDay === 5) { // Friday
                addDaysUTC(deadlineDate, 2); // Sun
                addDaysUTC(announceDate, 2);
            } else if (etDay === 6) { // Saturday
                addDaysUTC(deadlineDate, 1); // Sun
                addDaysUTC(announceDate, 1);
            }
            
            return { deadline: deadlineDate, announce: announceDate };
        }

        /**
         * å‰å›ã®ç· åˆ‡ (éå») ã‚’è¨ˆç®—ã—ã¾ã™
         */
        function getPreviousDeadlineET(nowInET_Date, deadlineUTCHour, announceUTCHour) {
            // nowInET_Date ã¯ Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (UTCæ™‚åˆ»åŸºæº–)
            const etDay = nowInET_Date.getUTCDay();   // 0=Sun, 1=Mon, ..., 6=Sat
            const etHour = nowInET_Date.getUTCHours(); // 0-23

            let deadlineDate = new Date(nowInET_Date.getTime());
            deadlineDate.setUTCHours(deadlineUTCHour, 0, 0, 0);

            let announceDate = new Date(nowInET_Date.getTime());
            announceDate.setUTCHours(announceUTCHour, 0, 0, 0);

            // arXivã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ (é€†ç®—)
            if (etDay === 0) { // Sunday
                if (etHour < 14) {
                    addDaysUTC(deadlineDate, -3); // Thu
                    addDaysUTC(announceDate, -3);
                }
            } else if (etDay >= 1 && etDay <= 4) { // Mon, Tue, Wed, Thu
                if (etHour < 14) {
                    addDaysUTC(deadlineDate, -1); // Previous day
                    addDaysUTC(announceDate, -1);
                }
            } else if (etDay === 5) { // Friday
                addDaysUTC(deadlineDate, -1); // Thu
                addDaysUTC(announceDate, -1);
            } else if (etDay === 6) { // Saturday
                addDaysUTC(deadlineDate, -2); // Thu
                addDaysUTC(announceDate, -2);
            }
            
            return { deadline: deadlineDate, announce: announceDate };
        }

        /**
         * Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (UTCåŸºæº–) ã«æ—¥æ•°ã‚’åŠ ç®—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
         */
        function addDaysUTC(date, days) {
            date.setUTCDate(date.getUTCDate() + days);
        }

    </script>
</body>
</html>

